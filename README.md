## Поворотный регулятор на STM32F030F4 и LIS2DH12. 
                                                                                                                            
                                                                                                                            
**Программа предназначена для формирования сигнала управления, в зависимости  от  угла**  
**поворота акселерометра в плоскости XY. Может служить основой для  диммера,**  
**термостата и других устройств с поворотным регулятором.**
   
  Программа реализует конечный автомат с двумя состояниями:  WORK_STATE и SLEEP_STATE.  
Каждому состоянию соответствует свой набор действий и свои настройки акселерометра.  
Тактирование автомата осуществляется  сигналом внешнего  прерывания  от акселерометра.  

#### Состояние  WORK_STATE :
Акселерометр настроен на  проведение периодических измерений  и формирование сигнала   
готовности данных. Контроллер обрабатывает сигнал готовности данных как внешнее   
прерывание и запускает выполнение следующих процедур:  
* чтение данных акселерометра по шине I2C,
* контроль допустимого отклонения плоскости XY от вертикали,
* расчет угла поворота акселерометра в осях XY,
* формирование и передачу сигнала управления модулю ШИМ,
* проверка условия отсутствия движения, 
* рестарт сторожевого таймера.  
       
       
Если движение продолжается микроконтроллер переходит в режим пониженного   
энергопотребления до следующего сигнала готовности данных от акселерометра.  
Если регулятор не трогают выполняется переход в состояние SLEEP_STATE:
* настройка акселерометра для режима SLEEP_STATE,
* включение прерывания от таймера общего назначения,
* переход автомата в состояние  SLEEP_STATE,
* переход контроллера в режим пониженного энергопотребления.

#### Состояние  SLEEP_STATE :
Акселерометр настроен на ожидание движения и формирует сигнал прерывания только при   
изменении положения. Микроконтроллер находится в режиме пониженного энергопотребления,   
сторожевой таймер перезапускается в прерывании от таймера общего назначения.  
При обнаружении движения происходит переход в состояние WORK_STATE:  
* настройка акселерометра для режима WORK_STATE
* выключение прерывания от таймера общего назначения
* переход автомата в состояние  WORK_STATE
* переход контроллера в режим пониженного энергопотребления
